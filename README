conversion of the following code:

https://github.com/lainme/UGKS/zipball/master
